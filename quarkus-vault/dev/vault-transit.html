<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using HashiCorp Vault&#8217;s Transit Secret Engine :: Quarkiverse Documentation</title>
    <link rel="canonical" href="https://quarkiverse.github.io/quarkiverse-docs/quarkus-vault/dev/vault-transit.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-extra.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="../..">Quarkiverse</a>
        <span class="separator">//</span>
        <a href="https://quarkiverse.github.io/quarkiverse-docs">Docs</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Projects</div>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Index</a>
            <a class="navbar-item" href="#">Quarkus - Java Embedded Framework</a>
            <a class="navbar-item" href="#">Quarkus Amazon Alexa</a>
            <a class="navbar-item" href="#">Quarkus Amazon Services</a>
            <a class="navbar-item" href="#">Quarkus Artemis</a>
            <a class="navbar-item" href="#">Quarkus Config Extensions</a>
            <a class="navbar-item" href="#">Quarkus Cucumber</a>
            <a class="navbar-item" href="#">Quarkus CXF</a>
            <a class="navbar-item" href="#">Quarkus Dapr</a>
            <a class="navbar-item" href="#">Quarkus File Vault</a>
            <a class="navbar-item" href="#">Quarkus Freemarker</a>
            <a class="navbar-item" href="#">Quarkus GitHub Action</a>
            <a class="navbar-item" href="#">Quarkus GitHub App</a>
            <a class="navbar-item" href="#">Quarkus Google Cloud Services</a>
            <a class="navbar-item" href="#">Quarkus Helm</a>
            <a class="navbar-item" href="#">Quarkus Hibernate Search Extras</a>
            <a class="navbar-item" href="#">Quarkus Hibernate types</a>
            <a class="navbar-item" href="#">Quarkus HiveMQ Client</a>
            <a class="navbar-item" href="#">Quarkus JDBC Sqlite</a>
            <a class="navbar-item" href="#">Quarkus JGit</a>
            <a class="navbar-item" href="#">Quarkus JGraphT</a>
            <a class="navbar-item" href="#">Quarkus JSch</a>
            <a class="navbar-item" href="#">Quarkus Kerberos</a>
            <a class="navbar-item" href="#">Quarkus Logging JSON</a>
            <a class="navbar-item" href="#">Quarkus Logging Logback</a>
            <a class="navbar-item" href="#">Quarkus Logging Sentry</a>
            <a class="navbar-item" href="#">Quarkus Logging Splunk</a>
            <a class="navbar-item" href="#">Quarkus Micrometer Registry extensions</a>
            <a class="navbar-item" href="#">Quarkus Mockk</a>
            <a class="navbar-item" href="#">Quarkus MyBatis</a>
            <a class="navbar-item" href="#">Quarkus Neo4j</a>
            <a class="navbar-item" href="#">Quarkus Operator SDK</a>
            <a class="navbar-item" href="#">Quarkus Prettytime</a>
            <a class="navbar-item" href="#">Quarkus Quinoa</a>
            <a class="navbar-item" href="#">Quarkus RabbitMQ Client</a>
            <a class="navbar-item" href="#">Quarkus Reactive Messaging HTTP</a>
            <a class="navbar-item" href="#">Quarkus Renarde</a>
            <a class="navbar-item" href="#">Quarkus Tika</a>
            <a class="navbar-item" href="#">Quarkus Unleash</a>
            <a class="navbar-item" href="#">Quarkus Vault</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <div class="navbar-link">Community</div>
          <div class="navbar-dropdown is-right">
            <a class="navbar-item" href="https://quarkusio.zulipchat.com">Chat</a>
          </div>
        </div>
        <a class="navbar-item" href="https://twitter.com/quarkusio">
          <span class="icon">
            <svg aria-hidden="true" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
              <path fill="#57aaee" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path>
            </svg>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="quarkus-vault" data-version="dev">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Quarkus Vault</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Quarkus Vault</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vault-auth.html">Vault Authentication guide</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="vault-transit.html">Vault Transit Secret Engine Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vault-pki.html">Vault PKI Secret Engine Guide</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="vault-datasource.html">Vault Datasource Guide</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Quarkus Vault</span>
    <span class="version">dev</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../index/index/index.html">Index</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../index/index/index.html">index</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-java-embedded-framework/dev/index.html">Quarkus - Java Embedded Framework</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-java-embedded-framework/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-amazon-alexa/dev/index.html">Quarkus Amazon Alexa</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-amazon-alexa/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-amazon-services/dev/index.html">Quarkus Amazon Services</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-amazon-services/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-artemis/dev/index.html">Quarkus Artemis</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-artemis/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-config-extensions/dev/index.html">Quarkus Config Extensions</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-config-extensions/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-cucumber/dev/index.html">Quarkus Cucumber</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-cucumber/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-cxf/dev/index.html">Quarkus CXF</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-cxf/dev/index.html">dev</a>
        </li>
        <li class="version">
          <a href="../../quarkus-cxf/v1.x/index.html">v1.x</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-dapr/dev/index.html">Quarkus Dapr</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-dapr/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-file-vault/dev/index.html">Quarkus File Vault</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-file-vault/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-freemarker/dev/index.html">Quarkus Freemarker</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-freemarker/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-github-action/dev/index.html">Quarkus GitHub Action</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-github-action/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-github-app/dev/index.html">Quarkus GitHub App</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-github-app/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-google-cloud-services/main/index.html">Quarkus Google Cloud Services</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-google-cloud-services/main/index.html">main</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-helm/dev/index.html">Quarkus Helm</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-helm/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-hibernate-search-extras/dev/index.html">Quarkus Hibernate Search Extras</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-hibernate-search-extras/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-hibernate-types/dev/index.html">Quarkus Hibernate types</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-hibernate-types/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-hivemq-client/dev/index.html">Quarkus HiveMQ Client</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-hivemq-client/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-JDBC-Sqlite/dev/index.html">Quarkus JDBC Sqlite</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-JDBC-Sqlite/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-jgit/dev/index.html">Quarkus JGit</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-jgit/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-jgrapht/dev/index.html">Quarkus JGraphT</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-jgrapht/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-jsch/dev/index.html">Quarkus JSch</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-jsch/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-kerberos/dev/index.html">Quarkus Kerberos</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-kerberos/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-logging-json/dev/index.html">Quarkus Logging JSON</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-logging-json/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-logging-logback/dev/index.html">Quarkus Logging Logback</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-logging-logback/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-logging-sentry/dev/index.html">Quarkus Logging Sentry</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-logging-sentry/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-logging-splunk/dev/index.html">Quarkus Logging Splunk</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-logging-splunk/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-micrometer-registry/dev/index.html">Quarkus Micrometer Registry extensions</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-micrometer-registry/dev/index.html">dev</a>
        </li>
        <li class="version">
          <a href="../../quarkus-micrometer-registry/1.x/index.html">1.x</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-mockk/dev/index.html">Quarkus Mockk</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-mockk/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-mybatis/dev/index.html">Quarkus MyBatis</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-mybatis/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-neo4j/dev/index.html">Quarkus Neo4j</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-neo4j/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-operator-sdk/dev/index.html">Quarkus Operator SDK</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-operator-sdk/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-prettytime/dev/index.html">Quarkus Prettytime</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-prettytime/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-quinoa/dev/index.html">Quarkus Quinoa</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-quinoa/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-rabbitmq-client/0.1.0/index.html">Quarkus RabbitMQ Client</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-rabbitmq-client/0.1.0/index.html">0.1.0</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-reactive-messaging-http/dev/index.html">Quarkus Reactive Messaging HTTP</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-reactive-messaging-http/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-renarde/dev/index.html">Quarkus Renarde</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-renarde/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-tika/dev/index.html">Quarkus Tika</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-tika/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../quarkus-unleash/dev/index.html">Quarkus Unleash</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../quarkus-unleash/dev/index.html">dev</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="index.html">Quarkus Vault</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">dev</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../index/index/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Quarkus Vault</a></li>
    <li><a href="vault-transit.html">Vault Transit Secret Engine Guide</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/quarkiverse/quarkus-vault/edit/main/docs/modules/ROOT/pages/vault-transit.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Using HashiCorp Vault&#8217;s Transit Secret Engine</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Vault&#8217;s Transit Secret Engine offers an "encryption as a service" functionality. It allows to store encryption
keys into Vault, and provides services to encrypt/decrypt and sign/verify arbitrary pieces of data. This brings
several advantages, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>limited key exposure: keys never leave the Vault. Instead the data is sent to Vault to get
encrypted/decrypted/signed/verified.</p>
</li>
<li>
<p>reliable and consistent algorithms: algorithms are implemented by Vault. It supports a wide variety, and there is
only one implementation used for a given algorithm type, regardless of the client&#8217;s technology.</p>
</li>
<li>
<p>it relieves developers from having to embed cryptographic libraries into their applications.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the context of Quarkus, the main (non administration) services are being covered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>encrypt: encrypt some data and return the cipher text</p>
</li>
<li>
<p>decrypt: decrypt the cipher text and return the clear data</p>
</li>
<li>
<p>rewrap: reencrypt a cipher text using the most recent key version</p>
</li>
<li>
<p>sign: sign a piece of data</p>
</li>
<li>
<p>verify signature: verify that a signature is correct for a piece of data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See <a href="https://www.vaultproject.io/docs/secrets/transit/index.html#transit-secrets-engine">Vault Transit Secret Engine&#8217;s official documentation</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites"><a class="anchor" href="#_prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to complete the "Starting Vault" section of the <a href="#vault.adoc" class="xref unresolved">Vault guide</a></p>
</li>
<li>
<p>roughly 15 minutes</p>
</li>
<li>
<p>an IDE</p>
</li>
<li>
<p>JDK 11+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.8.1+</p>
</li>
<li>
<p>Docker installed</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup"><a class="anchor" href="#_setup"></a>Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We assume there is a Vault running from the <a href="#vault.adoc" class="xref unresolved">Vault guide</a>, and the root token is known.
The first step consists in activating the Transit Secret Engine, and creating the different keys:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker exec -it dev-vault sh
export VAULT_TOKEN=s.5VUS8pte13RqekCB2fmMT3u2

vault secrets enable transit
# ==&gt; Success! Enabled the transit secrets engine at: transit/

vault write -f transit/keys/my-encryption-key
# ==&gt; Success! Data written to: transit/keys/my-encryption-key

vault write transit/keys/my-sign-key type=ecdsa-p256
# ==&gt; Success! Data written to: transit/keys/my-sign-key</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you did not have to provide the key value. You only provide its name, and Vault will generate it for you and
keep it secured.</p>
</div>
<div class="paragraph">
<p>Once the keys have been created, we now need to create a policy that provides access for it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat &lt;&lt;EOF | vault policy write vault-transit-quickstart-policy -
path "transit/encrypt/my-encryption-key" {
  capabilities = [ "update" ]
}
path "transit/decrypt/my-encryption-key" {
  capabilities = [ "update" ]
}
path "transit/sign/my-sign-key" {
  capabilities = [ "update"]
}
path "transit/verify/my-sign-key" {
  capabilities = [ "update" ]
}
EOF
# ==&gt; Success! Uploaded policy: vault-transit-quickstart-policy</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, let&#8217;s add the <code>vault-transit-quickstart-policy</code> to user <code>bob</code> that was created in the <a href="#vault.adoc" class="xref unresolved">Vault guide</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vault write auth/userpass/users/bob password=sinclair policies=vault-quickstart-policy,vault-transit-quickstart-policy</code></pre>
</div>
</div>
<div class="paragraph">
<p>To check that the configuration is correct, try logging in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vault login -method=userpass username=bob password=sinclair</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Success! You are now authenticated. The token information displayed below
is already stored in the token helper. You do NOT need to run "vault login"
again. Future Vault requests will automatically use this token.

Key                    Value
---                    -----
token                  s.s93BVzJPzBiIGuYJHBTkG8Uw
token_accessor         OKNipTAgxWbxsrjixASNiwdY
token_duration         768h
token_renewable        true
token_policies         ["default" "vault-quickstart-policy"]
identity_policies      []
policies               ["default" "vault-quickstart-policy"]
token_meta_username    bob</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now set <code>VAULT_TOKEN</code> to the <code>token</code> above (instead of the root token), and try encrypting some data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export VAULT_TOKEN=s.s93BVzJPzBiIGuYJHBTkG8Uw
# note: "my secret data" in base64 is "bXkgc2VjcmV0IGRhdGEK"
vault write transit/encrypt/my-encryption-key plaintext=bXkgc2VjcmV0IGRhdGEK</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Key           Value
---           -----
ciphertext    vault:v1:vIQxsLANFbcfKofJL55zjoIXV6MqAzvjKUUQLGg5pWTz0W2Qab/B4nEJaQ==</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_encrypt_and_decrypt"><a class="anchor" href="#_encrypt_and_decrypt"></a>Encrypt and Decrypt</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, let&#8217;s create a simple Quarkus application with Vault and Jackson extensions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus.platform:quarkus-maven-plugin:2.8.0.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=vault-transit-quickstart \
    -DclassName="org.acme.quickstart.GreetingResource" \
    -Dpath="/hello" \
    -Dextensions="resteasy,vault,resteasy-jackson"
cd vault-transit-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, configure access to Vault from the <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"># vault url
quarkus.vault.url=http://localhost:8200

# vault authentication
quarkus.vault.authentication.userpass.username=bob
quarkus.vault.authentication.userpass.password=sinclair</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you did not need to specify the existence of a particular encryption key in the configuration. You only
do so in special cases such as specifying the key type for upsert, or changing the signature algorithm, &#8230;&#8203; Check the complete configuration for more
information.</p>
</div>
<div class="paragraph">
<p>We can then add a new endpoint that will allow us to encrypt and decrypt data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Path("/transit")
@Produces(TEXT_PLAIN)
@Consumes(TEXT_PLAIN)
public class TransitResource {

    @Inject
    public VaultTransitSecretEngine transitSecretEngine;

    @POST
    @Path("/encrypt")
    public String encrypt(String clearData) {
        return transitSecretEngine.encrypt("my-encryption-key", clearData);
    }

    @POST
    @Path("/decrypt")
    public String decrypt(String cipherText) {
        return transitSecretEngine.decrypt("my-encryption-key", cipherText).asString();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After compiling and starting the Quarkus application, let&#8217;s encrypt some data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST --data 'some secret data' --header "Content-Type: text/plain"  http://localhost:8080/transit/encrypt
# ==&gt; vault:v1:fN4P7WNjIegpb3lD/pSuhXvyONhGrI21gcKNcedk+5jpjguOw6JkqXYXlkY=</code></pre>
</div>
</div>
<div class="paragraph">
<p>And decrypt back this cipher text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST --data 'vault:v1:fN4P7WNjIegpb3lD/pSuhXvyONhGrI21gcKNcedk+5jpjguOw6JkqXYXlkY=' --header "Content-Type: text/plain"  http://localhost:8080/transit/decrypt
# ==&gt; some secret data</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sign_and_verify"><a class="anchor" href="#_sign_and_verify"></a>Sign and Verify</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s add 2 new methods to our <code>TransitResource</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@POST
@Path("/sign")
public String sign(String input) {
    return transitSecretEngine.sign("my-sign-key", input);
}

public static class VerifyRequest {
    public String signature;
    public String input;
}

@POST
@Path("/verify")
@Consumes(APPLICATION_JSON)
public Response verify(VerifyRequest request) {
    transitSecretEngine.verifySignature("my-sign-key", request.signature, request.input);
    return Response.accepted().build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And start signing some data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -X POST --data 'some secret data' --header "Content-Type: text/plain"  http://localhost:8080/transit/sign
# ==&gt; vault:v1:MEUCIQDl+nE4y4E878bkugGG6FG1/RsttaQnoWfZHppeuk4TnQIgTGWTtMhVPCzN8VH/EEr2qp5h34lI1bnEP6L1F+QQoPI=</code></pre>
</div>
</div>
<div class="paragraph">
<p>And finally, let&#8217;s make sure the signature is matching our input data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl -v -X POST --data '{"input":"some secret data","signature":"vault:v1:MEUCIQDl+nE4y4E878bkugGG6FG1/RsttaQnoWfZHppeuk4TnQIgTGWTtMhVPCzN8VH/EEr2qp5h34lI1bnEP6L1F+QQoPI="}' --header "Content-Type: application/json" http://localhost:8080/transit/verify
# ==&gt; ... &lt; HTTP/1.1 202 Accepted</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_conclusion"><a class="anchor" href="#_conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Transit Secret Engine is a powerful tool in the enterprise.
We have seen the most obvious functions of the interface, but the rest of the methods or flavors
should not be overlooked:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For instance batch oriented methods are strongly recommended for mass operations (encrypt, decrypt, &#8230;&#8203;)</p>
</li>
<li>
<p>Transit contexts allow key derivation where one key is used to derive other keys for specific named contexts
(e.g. person names, person addresses, &#8230;&#8203;)</p>
</li>
<li>
<p>Rewrapping allows to reencrypt data with the most recent key version when the Vault administrator decides to
rotate keys</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Feel free to look at the <code>VaultTransitSecretEngine</code> interface plus the dedicated Transit Secret Engine configuration
properties in the <a href="#vault.adoc" class="xref unresolved">Vault guide</a> for all the details.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright (C) 2020-2022 <a href="https://www.redhat.com">Red Hat</a> and individual contributors to <a href="https://github.com/quarkiverse/quarkiverse-docs">Quarkiverse</a>.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
